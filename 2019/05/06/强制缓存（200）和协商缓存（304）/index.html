<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 强制缓存（200）和协商缓存（304） · HarryPang's Blog</title><meta name="description" content="强制缓存（200）和协商缓存（304） - Harry Pang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://github.com/ZhangQiangQQ/atom.xml" title="HarryPang's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">博客</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/2019/01/11/关于我" target="_self" class="nav-list-link">关于我</a></li><li class="nav-list-item"><a href="https://github.com/ZhangQiangQQ/" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">强制缓存（200）和协商缓存（304）</h1><div class="post-info">2019年5月6日</div><div class="post-content"><p>本文将介绍强制缓存（200）和协商缓存（304）的区别</p>
<h4 id="1-什么是缓存？"><a href="#1-什么是缓存？" class="headerlink" title="1. 什么是缓存？"></a>1. 什么是缓存？</h4><p>浏览器缓存(Brower Caching)是浏览器对之前请求过的文件进行缓存，以便下一次访问时重复使用，节省带宽，提高访问速度，降低服务器压力</p>
<p>http缓存机制主要在http响应头中设定，响应头中相关字段为Expires、Cache-Control、Last-Modified、If-Modified-Since、Etag。</p>
<p>HTTP 1.0协议中的。简而言之，就是告诉浏览器在约定的这个时间前，可以直接从缓存中获取资源（representations），而无需跑到服务器去获取。</p>
<p>另：Expires因为是对时间设定的，且时间是Greenwich Mean Time （GMT），而不是本地时间，所以对时间要求较高。</p>
<h4 id="2-浏览器是如何判断是否使用缓存的"><a href="#2-浏览器是如何判断是否使用缓存的" class="headerlink" title="2. 浏览器是如何判断是否使用缓存的"></a>2. 浏览器是如何判断是否使用缓存的</h4><p>第一次请求：</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/6/16a8bbc2df77f4f6?w=411&amp;h=369&amp;f=png&amp;s=26885" alt=""><br>第二次请求相同网页：</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/6/16a8bbaefa56810f?w=554&amp;h=528&amp;f=png&amp;s=103197" alt=""></p>
<h4 id="3-缓存的类别"><a href="#3-缓存的类别" class="headerlink" title="3. 缓存的类别"></a>3. 缓存的类别</h4><p>浏览器缓存分为强缓存和协商缓存</p>
<h5 id="强缓存：浏览器不会像服务器发送任何请求，直接从本地缓存中读取文件并返回Status-Code-200-OK"><a href="#强缓存：浏览器不会像服务器发送任何请求，直接从本地缓存中读取文件并返回Status-Code-200-OK" class="headerlink" title="强缓存：浏览器不会像服务器发送任何请求，直接从本地缓存中读取文件并返回Status Code: 200 OK"></a>强缓存：浏览器不会像服务器发送任何请求，直接从本地缓存中读取文件并返回Status Code: 200 OK</h5><p><img src="https://user-gold-cdn.xitu.io/2019/5/6/16a8bc0c7e54f6ec?w=317&amp;h=112&amp;f=png&amp;s=9790" alt=""></p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/6/16a8bdbc4b9c8720?w=280&amp;h=96&amp;f=png&amp;s=7498" alt=""></p>
<blockquote>
<p>200 form memory cache :<br>不访问服务器，一般已经加载过该资源且缓存在了内存当中，直接从内存中读取缓存。浏览器关闭后，数据将不存在（资源被释放掉了），再次打开相同的页面时，不会出现from memory cache。</p>
</blockquote>
<blockquote>
<p>200 from disk cache：<br>不访问服务器，已经在之前的某个时间加载过该资源，直接从硬盘中读取缓存，关闭浏览器后，数据依然存在，此资源不会随着该页面的关闭而释放掉下次打开仍然会是from disk cache。</p>
</blockquote>
<blockquote>
<p>优先访问memory cache,其次是disk cache，最后是请求网络资源</p>
</blockquote>
<h5 id="协商缓存-向服务器发送请求，服务器会根据这个请求的request-header的一些参数来判断是否命中协商缓存，如果命中，则返回304状态码并带上新的response-header通知浏览器从缓存中读取资源；"><a href="#协商缓存-向服务器发送请求，服务器会根据这个请求的request-header的一些参数来判断是否命中协商缓存，如果命中，则返回304状态码并带上新的response-header通知浏览器从缓存中读取资源；" class="headerlink" title="协商缓存: 向服务器发送请求，服务器会根据这个请求的request header的一些参数来判断是否命中协商缓存，如果命中，则返回304状态码并带上新的response header通知浏览器从缓存中读取资源；"></a>协商缓存: 向服务器发送请求，服务器会根据这个请求的request header的一些参数来判断是否命中协商缓存，如果命中，则返回304状态码并带上新的response header通知浏览器从缓存中读取资源；</h5><p><img src="https://user-gold-cdn.xitu.io/2019/5/6/16a8bc3172e3a167?w=293&amp;h=47&amp;f=png&amp;s=3340" alt=""></p>
<h4 id="4-强缓存和协商缓存的header参数"><a href="#4-强缓存和协商缓存的header参数" class="headerlink" title="4. 强缓存和协商缓存的header参数"></a>4. 强缓存和协商缓存的header参数</h4><p>强缓存：</p>
<p>Expires：过期时间，如果设置了时间，则浏览器会在设置的时间内直接读取缓存，不再请求</p>
<p>Cache-Control：当值设为max-age=300时，则代表在这个请求正确返回时间（浏览器也会记录下来）的5分钟内再次加载资源，就会命中强缓存。</p>
<p>cache-control：除了该字段外，还有下面几个比较常用的设置值：</p>
<pre><code>（1） max-age：用来设置资源（representations）可以被缓存多长时间，单位为秒；
（2） s-maxage：和max-age是一样的，不过它只针对代理服务器缓存而言；
（3）public：指示响应可被任何缓存区缓存；
（4）private：只能针对个人用户，而不能被代理服务器缓存；
（5）no-cache：强制客户端直接向服务器发送请求,也就是说每次请求都必须向服务器发送。服务器接收到     请求，然后判断资源是否变更，是则返回新内容，否则返回304，未变更。这个很容易让人产生误解，使人误     以为是响应不被缓存。实际上Cache-Control:     no-cache是会被缓存的，只不过每次在向客户端（浏览器）提供响应数据时，缓存都要向服务器评估缓存响应的有效性。
（6）no-store：禁止一切缓存（这个才是响应不被缓存的意思）。
</code></pre><p>协商缓存：</p>
<p>Last-Modifued/If-Modified-Since和Etag/If-None-Match是分别成对出现的，呈一一对应关系</p>
<h5 id="Etag-If-None-Match："><a href="#Etag-If-None-Match：" class="headerlink" title="Etag/If-None-Match："></a>Etag/If-None-Match：</h5><p>Etag：</p>
<blockquote>
<p>Etag是属于HTTP 1.1属性，它是由服务器（Apache或者其他工具）生成返回给前端，用来帮助服务器控制Web端的缓存验证。<br>Apache中，ETag的值，默认是对文件的索引节（INode），大小（Size）和最后修改时间（MTime）进行Hash后得到的。</p>
</blockquote>
<p>If-None-Match: </p>
<blockquote>
<p>当资源过期时，浏览器发现响应头里有Etag,则再次像服务器请求时带上请求头if-none-match(值是Etag的值)。服务器收到请求进行比对，决定返回200或304</p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/6/16a8c60fb0ef49f0?w=918&amp;h=279&amp;f=png&amp;s=20766" alt=""></p>
<h5 id="Last-Modifued-If-Modified-Since："><a href="#Last-Modifued-If-Modified-Since：" class="headerlink" title="Last-Modifued/If-Modified-Since："></a>Last-Modifued/If-Modified-Since：</h5><p>Last-Modified：</p>
<blockquote>
<p>浏览器向服务器发送资源最后的修改时间</p>
</blockquote>
<p>If-Modified-Since：</p>
<blockquote>
<p>当资源过期时（浏览器判断Cache-Control标识的max-age过期），发现响应头具有Last-Modified声明，则再次像服务器请求时带上头if-modified-since，表示请求时间。服务器收到请求后发现有if-modified-since则与被请求资源的最后修改时间进行对比（Last-Modified）,若最后修改时间较新（大），说明资源又被改过，则返回最新资源，HTTP 200 OK;若最后修改时间较旧（小），说明资源无新修改，响应HTTP 304 走缓存。</p>
</blockquote>
<blockquote>
<p>Last-Modifued/If-Modified-Since的时间精度是秒，而Etag可以更精确。<br>Etag优先级是高于Last-Modifued的，所以服务器会优先验证Etag</p>
</blockquote>
</div></article></div></main><footer><div class="paginator"><a href="/2019/05/07/10个前端面试必会题目！（适用于中高级）/" class="prev">PREV</a><a href="/2019/04/10/浏览器缓存的了解/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2019 <a href="https://github.com/ZhangQiangQQ">Harry Pang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>