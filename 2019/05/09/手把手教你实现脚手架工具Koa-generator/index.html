<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 手把手教你实现脚手架工具Koa-generator · HarryPang's Blog</title><meta name="description" content="手把手教你实现脚手架工具Koa-generator - Harry Pang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://github.com/ZhangQiangQQ/atom.xml" title="HarryPang's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">博客</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/2019/01/11/关于我" target="_self" class="nav-list-link">关于我</a></li><li class="nav-list-item"><a href="https://github.com/ZhangQiangQQ/" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">手把手教你实现脚手架工具Koa-generator</h1><div class="post-info">2019年5月9日</div><div class="post-content"><p>我们日常中经常使用各种cli来加速我们的工作，你们也一定和我一样想知道这些cli内部都干了什么？接下来我们就以实现一个koa-generator来打开脚手架工具的大门，来跟着我一步一步做吧：</p>
<p><code>为了加快我们的学习进度，更快的理解cli，我们这里会省略一些内容，旨在帮助大家更快建立基本的概念和入门方法</code></p>
<h3 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h3><p>首先我们先对我们要实现的工具做一个简单的需求分析：</p>
<ol>
<li>自动化生成koa初始项目结构</li>
<li>可以自定义一些内容</li>
<li>发布</li>
</ol>
<p>是不是很简单？没错，真的很简单！</p>
<h3 id="逐步实现"><a href="#逐步实现" class="headerlink" title="逐步实现"></a>逐步实现</h3><h4 id="1"><a href="#1" class="headerlink" title="1"></a>1</h4><p>想要自动化生成koa初始项目结构的前提，就是要知道我们构建出来的结构是什么样的：</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/9/16a9b4ab026e0644?w=299&amp;h=371&amp;f=png&amp;s=17255" alt=""></p>
<p>上图就是我们想要生成的项目结构</p>
<p>明确了我们的目的接下来就开始着手吧！</p>
<h4 id="2"><a href="#2" class="headerlink" title="2"></a>2</h4><h4 id="2-1"><a href="#2-1" class="headerlink" title="2.1"></a>2.1</h4><p>创建文件夹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir koa-simple-generator</span><br></pre></td></tr></table></figure></p>
<h4 id="2-2"><a href="#2-2" class="headerlink" title="2.2"></a>2.2</h4><p>进入项目目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd koa-simple-generator</span><br></pre></td></tr></table></figure></p>
<h4 id="2-3"><a href="#2-3" class="headerlink" title="2.3"></a>2.3</h4><p>初始化npm（等不及实践就一路enter，后面也可以再做修改）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure></p>
<h4 id="2-4"><a href="#2-4" class="headerlink" title="2.4"></a>2.4</h4><p>打开我们的package.json，如下</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/9/16a9b511c3717d41?w=498&amp;h=235&amp;f=png&amp;s=14605" alt=""></p>
<p>将下面的代码复制到package.json里<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;koa-simple-generator&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;&quot;,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;author&quot;: &quot;&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &quot;main&quot;: &quot;bin/wowKoa&quot;,</span><br><span class="line">  &quot;bin&quot;: &#123;</span><br><span class="line">    &quot;koa2&quot;: &quot;./bin/wowKoa&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;commander&quot;: &quot;2.7.1&quot;,</span><br><span class="line">    &quot;mkdirp&quot;: &quot;0.5.1&quot;,</span><br><span class="line">    &quot;sorted-object&quot;: &quot;1.0.0&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;devDependencies&quot;: &#123;</span><br><span class="line">    &quot;mocha&quot;: &quot;2.2.5&quot;,</span><br><span class="line">    &quot;rimraf&quot;: &quot;~2.2.8&quot;,</span><br><span class="line">    &quot;supertest&quot;: &quot;1.0.1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;engines&quot;: &#123;</span><br><span class="line">    &quot;node&quot;: &quot;&gt;= 7.0&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. dependencies和devDependencies简单来说就是应用的依赖包，devDependencies只会在开发环境安装</span><br><span class="line"></span><br><span class="line">2. 这句话的意思是我们的这个工具需要node7.0及以上的版本才能支持</span><br><span class="line">&quot;engines&quot;: &#123;</span><br><span class="line">    &quot;node&quot;: &quot;&gt;= 7.0&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">重点是这两句</span><br><span class="line">&quot;main&quot;: &quot;bin/wowKoa&quot;,</span><br><span class="line">  &quot;bin&quot;: &#123;</span><br><span class="line">    &quot;wowKoa&quot;: &quot;./bin/wowKoa&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  意思是默认执行的是bin目录下的wowKoa，</span><br><span class="line">  执行wowKoa的命令，执行的也是bin目录下的wowKoa，</span><br></pre></td></tr></table></figure>
<p>####2.5<br>接下来安装我们的依赖吧<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i</span><br></pre></td></tr></table></figure></p>
<h4 id="2-6"><a href="#2-6" class="headerlink" title="2.6"></a>2.6</h4><p>安装完，我们新建一个目录template<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir template</span><br></pre></td></tr></table></figure></p>
<p>然后我们可以把我们想要生成的目录结构拷贝进去，这里我就只是把koa2的目录拷贝进去，现在我们的目录长这样：</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/9/16a9b5f29ca24773?w=256&amp;h=240&amp;f=png&amp;s=10184" alt=""></p>
<h4 id="2-7"><a href="#2-7" class="headerlink" title="2.7"></a>2.7</h4><p>新建bin目录，在bin下新建文件wowKoa</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/9/16a9b632f0c8d54e?w=314&amp;h=166&amp;f=png&amp;s=7354" alt=""></p>
<h4 id="2-8"><a href="#2-8" class="headerlink" title="2.8"></a>2.8</h4><p>接下来就是关键了，我们的所有工作都是在bin下的wowKoa文件里完成的<br>直接复制粘贴下面的，然后进入项目目录运行<code>node bin/wowKoa</code>就能看到结果了</p>
<p><em>代码我已经大部分都注释啦</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env node</span><br><span class="line"> // 告诉Unix和Linux系统这个文件中的代码用node可执行程序去运行</span><br><span class="line">var program = require(&apos;commander&apos;);</span><br><span class="line">var mkdirp = require(&apos;mkdirp&apos;);</span><br><span class="line">var os = require(&apos;os&apos;);</span><br><span class="line">var fs = require(&apos;fs&apos;);</span><br><span class="line">var fsm = require(&apos;fs-extra&apos;)</span><br><span class="line">var path = require(&apos;path&apos;);</span><br><span class="line">var readline = require(&apos;readline&apos;);</span><br><span class="line">var pkg = require(&apos;../package.json&apos;);</span><br><span class="line"></span><br><span class="line">// 退出node进程</span><br><span class="line">var _exit = process.exit;</span><br><span class="line">// s.EOL属性是一个常量，返回当前操作系统的换行符（Windows系统是\r\n，其他系统是\n）</span><br><span class="line">var eol = os.EOL;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">var version = pkg.version;</span><br><span class="line">// Re-assign process.exit because of commander</span><br><span class="line">// TODO: Switch to a different command framework</span><br><span class="line">process.exit = exit</span><br><span class="line"></span><br><span class="line">program</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * .version(&apos;0.0.1&apos;, &apos;-v, --version&apos;)</span><br><span class="line">     * 1版本号&lt;必须&gt;,</span><br><span class="line">     * 2自定义标志&lt;可省略&gt;：默认为 -V 和 --version</span><br><span class="line">     * </span><br><span class="line">     * .option(&apos;-n, --name&lt;path&gt;&apos;, &apos;name description&apos;, &apos;default name&apos;)</span><br><span class="line">     * 1 自定义标志&lt;必须&gt;：分为长短标识，中间用逗号、竖线或者空格分割；标志后面可跟必须参数或可选参数，前者用 &lt;&gt; 包含，后者用 [] 包含</span><br><span class="line">     * 2 选项描述&lt;省略不报错&gt;：在使用 --help 命令时显示标志描述</span><br><span class="line">     * 3 默认值&lt;可省略&gt;</span><br><span class="line">     * </span><br><span class="line">     * .usage(&apos;[options] [dir]&apos;)</span><br><span class="line">     * 作用：只是打印用法说明</span><br><span class="line">     * </span><br><span class="line">     * .parse(process.argv)</span><br><span class="line">     * 作用：用于解析process.argv，设置options以及触发commands</span><br><span class="line">     * process.argv获取命令行参数</span><br><span class="line">     * </span><br><span class="line">     * </span><br><span class="line">     * Commander提供了api来取消未定义的option自动报错机制， .allowUnknownOption()</span><br><span class="line">     */</span><br><span class="line">    .version(version, &apos;-v, --version&apos;)</span><br><span class="line">    .allowUnknownOption()</span><br><span class="line">    .usage(&apos;[options] [dir]&apos;)</span><br><span class="line">    .option(&apos;-f, --force&apos;, &apos;force on non-empty directory&apos;)</span><br><span class="line">    .parse(process.argv);</span><br><span class="line"></span><br><span class="line">// 没有退出时执行主函数</span><br><span class="line">if (!exit.exited) &#123;</span><br><span class="line">    main();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 主函数</span><br><span class="line"> */</span><br><span class="line">function main() &#123;</span><br><span class="line">    // 获取当前命令执行路径</span><br><span class="line">    var destinationPath = program.args.shift() || &apos;.&apos;;</span><br><span class="line">    // 根据文件夹名称定义appname</span><br><span class="line">    // 用于package.json里的name</span><br><span class="line">    var appName = path.basename(path.resolve(destinationPath));</span><br><span class="line"></span><br><span class="line">    // 判断当前文件目录是否为空</span><br><span class="line">    emptyDirectory(destinationPath, function (empty) &#123;</span><br><span class="line">        // 如果为空或者强制执行时，就直接生成项目</span><br><span class="line">        if (empty || program.force) &#123;</span><br><span class="line">            createApplication(appName, destinationPath);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // 否则询问</span><br><span class="line">            confirm(&apos;当前文件夹不为空，是否继续？[y/N] &apos;, function (ok) &#123;</span><br><span class="line">                if (ok) &#123;</span><br><span class="line">                        // 控制台不再输入时销毁</span><br><span class="line">                        process.stdin.destroy();</span><br><span class="line">                        createApplication(appName, destinationPath);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    console.error(&apos;aborting&apos;);</span><br><span class="line">                    exit(1);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Check if the given directory `path` is empty.</span><br><span class="line"> * 判断文件夹是否为空</span><br><span class="line"> * @param &#123;String&#125; path</span><br><span class="line"> * @param &#123;Function&#125; fn</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">function emptyDirectory(path, fn) &#123;</span><br><span class="line">    fs.readdir(path, function (err, files) &#123;</span><br><span class="line">        if (err &amp;&amp; &apos;ENOENT&apos; != err.code) throw err;</span><br><span class="line">        fn(!files || !files.length);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 在给定路径中创建应用</span><br><span class="line"> * @param &#123;String&#125; path</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">function createApplication(app_name, path) &#123;</span><br><span class="line">    // wait的值等于complete函数执行的次数</span><br><span class="line">    // 用于选择在哪一次complete函数执行后执行控制台打印引导使用的文案</span><br><span class="line">    var wait = 1;</span><br><span class="line">    console.log();</span><br><span class="line"></span><br><span class="line">    function complete() &#123;</span><br><span class="line">        if (--wait) return;</span><br><span class="line">        var prompt = launchedFromCmd() ? &apos;&gt;&apos; : &apos;$&apos;;</span><br><span class="line"></span><br><span class="line">        console.log();</span><br><span class="line">        console.log(&apos;   install dependencies:&apos;);</span><br><span class="line">        console.log(&apos;     %s cd %s &amp;&amp; npm install&apos;, prompt, path);</span><br><span class="line">        console.log();</span><br><span class="line">        console.log(&apos;   run the app:&apos;);</span><br><span class="line"></span><br><span class="line">        // 根据控制台的环境不同打印不同文案（linux或者win）</span><br><span class="line">        if (launchedFromCmd()) &#123;</span><br><span class="line">            console.log(&apos;     %s SET DEBUG=koa* &amp; npm start&apos;, prompt, app_name);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            console.log(&apos;     %s DEBUG=%s:* npm start&apos;, prompt, app_name);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    copytmp(complete, path,app_name)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 拷贝模拟里的文件到本地</span><br><span class="line">function copytmp(fn, destinationPath,app_name) &#123;</span><br><span class="line">    // 获取模板文件的文件目录</span><br><span class="line">    tmpPath = path.join(__dirname, &apos;..&apos;, &apos;template&apos;)</span><br><span class="line">    // 创建目录</span><br><span class="line">    fsm.ensureDir(destinationPath + &apos;/&apos;+app_name)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">            // 拷贝模板</span><br><span class="line">            fsm.copy(tmpPath, destinationPath + &apos;/&apos;+app_name, err =&gt; &#123;</span><br><span class="line">                if (err) return console.log(err)</span><br><span class="line">                fn()</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * Determine if launched from cmd.exe</span><br><span class="line"> * 判断控制台环境（liux或者win获取其他）</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">function launchedFromCmd() &#123;</span><br><span class="line">    return process.platform === &apos;win32&apos; &amp;&amp;</span><br><span class="line">        process.env._ === undefined;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * node是使用process.stdin和process.stdout来实现标准输入和输出的</span><br><span class="line"> * readline 模块提供了一个接口，用于一次一行地读取可读流（例如 process.stdin）中的数据。 它可以使用以下方式访问：</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">var rl = readline.createInterface(&#123;</span><br><span class="line">    input: process.stdin,</span><br><span class="line">    output: process.stdout</span><br><span class="line">&#125;);</span><br><span class="line">// 控制台问答</span><br><span class="line">function confirm(msg, callback) &#123;</span><br><span class="line">    rl.question(msg, function (input) &#123;</span><br><span class="line">        callback(/^y|yes|ok|true$/i.test(input));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 控制台问答</span><br><span class="line">function wrieQuestion(msg, callback) &#123;</span><br><span class="line">    rl.question(msg, function (input) &#123;</span><br><span class="line">        // rl.close()后就不再监听控制台输入了</span><br><span class="line">        rl.close();</span><br><span class="line">        callback(input)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 通过fs读取模板文件内容</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">function loadTemplate(name) &#123;</span><br><span class="line">    return fs.readFileSync(path.join(__dirname, &apos;..&apos;, &apos;template&apos;, name), &apos;utf-8&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * echo str &gt; path.</span><br><span class="line"> * 写入文件</span><br><span class="line"> * @param &#123;String&#125; path</span><br><span class="line"> * @param &#123;String&#125; str</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">function write(path, str, mode) &#123;</span><br><span class="line">    fs.writeFileSync(path, str, &#123; mode: mode || 0666 &#125;);</span><br><span class="line">    console.log(&apos;   \x1b[36mcreate\x1b[0m : &apos; + path);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 这里是主要解决在winodws上的一些bug，不用卡在这里，核心目的就是为了能让进程优雅退出</span><br><span class="line"> * Graceful exit for async STDIO</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">function exit(code) &#123;</span><br><span class="line">    // flush output for Node.js Windows pipe bug</span><br><span class="line">    // https://github.com/joyent/node/issues/6247 is just one bug example</span><br><span class="line">    // https://github.com/visionmedia/mocha/issues/333 has a good discussion</span><br><span class="line">    function done() &#123;</span><br><span class="line">        if (!(draining--)) _exit(code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var draining = 0;</span><br><span class="line">    var streams = [process.stdout, process.stderr];</span><br><span class="line"></span><br><span class="line">    exit.exited = true;</span><br><span class="line"></span><br><span class="line">    streams.forEach(function (stream) &#123;</span><br><span class="line">        // submit empty write request and wait for completion</span><br><span class="line">        draining += 1;</span><br><span class="line">        stream.write(&apos;&apos;, done);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    done();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</div></article></div></main><footer><div class="paginator"><a href="/2019/05/10/函数声明？函数表达式？我该怎么选？！/" class="prev">PREV</a><a href="/2019/05/07/10个前端面试必会题目！（适用于中高级）/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2019 <a href="https://github.com/ZhangQiangQQ">Harry Pang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>